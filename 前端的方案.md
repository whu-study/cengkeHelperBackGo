# 🚀 课程API响应格式建议

## 问题现状

当前每个教学楼只显示"其他楼层"，是因为原始API数据结构没有楼层概念，前端需要通过解析房间号来推断楼层，但解析逻辑有限制。

## 解决方案：新的API响应格式

### 推荐的API响应结构

```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "divisionId": "liberal_arts",
      "divisionName": "文理学部",
      "buildings": [
        {
          "buildingId": "building_a", 
          "buildingName": "文理学部教学楼A",
          "buildingCode": "A",
          "floors": [
            {
              "floorId": "A_1",
              "floorName": "A楼1层",
              "floorNumber": 1,
              "courses": [
                {
                  "id": 1,
                  "courseName": "高等数学A(1)",
                  "courseCode": "MATH101",
                  "teacherName": "张教授",
                  "teacherTitle": "教授", 
                  "faculty": "数学与统计学院",
                  "credits": 4,
                  "courseType": "必修课",
                  "room": "A101",
                  "timeSlots": [
                    {
                      "dayOfWeek": 1,
                      "startPeriod": 1,
                      "endPeriod": 2,
                      "weeks": "1-16周"
                    }
                  ],
                  "capacity": 120,
                  "enrolled": 85
                }
              ]
            },
            {
              "floorId": "A_2", 
              "floorName": "A楼2层",
              "floorNumber": 2,
              "courses": [...]
            }
          ]
        }
      ]
    }
  ]
}
```

## 核心改进点

### 1. 楼层信息明确化
- ✅ **之前**：需要从房间号推断楼层（容易出错）
- ✅ **现在**：后端直接提供楼层结构

### 2. 四级层次结构
```
学部 → 教学楼 → 楼层 → 课程
```

### 3. 时间信息标准化
- 支持多个时间段
- 明确的星期、节次、周数信息

## 快速实现建议

如果后端暂时无法完全重构，可以采用**渐进式改造**：

### 方案1：保持现有接口，增加楼层字段
```json
{
  "code": 0,
  "data": [
    [
      {
        "building": "文理学部教学楼A",
        "label": "文理学部教学楼A", 
        "value": 0,
        "infos": [
          {
            "id": 1,
            "room": "A101",
            "floor": "A楼1层",          // 新增楼层字段
            "floorNumber": 1,           // 新增楼层号
            "courseName": "高等数学A(1)",
            // ... 其他现有字段
          }
        ]
      }
    ]
  ]
}
```

### 方案2：在现有数据基础上增加楼层分组
```json
{
  "code": 0,
  "data": [
    [
      {
        "building": "文理学部教学楼A",
        "floors": [                    // 新增楼层分组
          {
            "floorName": "A楼1层",
            "courses": [
              {
                "id": 1,
                "room": "A101",
                "courseName": "高等数学A(1)",
                // ... 其他字段
              }
            ]
          },
          {
            "floorName": "A楼2层", 
            "courses": [...]
          }
        ]
      }
    ]
  ]
}
```

## 数据库调整建议

### 最小改动方案
如果不想大幅修改数据库，可以：

1. **在课程表中增加楼层字段**
```sql
ALTER TABLE courses ADD COLUMN floor_name VARCHAR(50);
ALTER TABLE courses ADD COLUMN floor_number INT;
```

2. **通过房间号自动填充楼层信息**
```sql
UPDATE courses 
SET floor_name = CONCAT(SUBSTRING(room, 1, 1), '楼', SUBSTRING(room, 2, 1), '层'),
    floor_number = CAST(SUBSTRING(room, 2, 1) AS UNSIGNED)
WHERE room REGEXP '^[A-Z][0-9]';
```

3. **API接口按楼层分组返回**
```python
# 示例Python代码
def get_courses_by_building(building_id):
    courses = Course.query.filter_by(building_id=building_id).all()
    
    # 按楼层分组
    floors = {}
    for course in courses:
        floor_key = course.floor_name or '其他楼层'
        if floor_key not in floors:
            floors[floor_key] = []
        floors[floor_key].append(course.to_dict())
    
    # 转换为数组格式
    return [
        {
            'floorName': floor_name,
            'courses': courses
        }
        for floor_name, courses in floors.items()
    ]
```

## 立即可用的解决方案

我已经在前端创建了适配器，可以：
1. 使用新的数据结构生成完整的Mock数据
2. 正确显示多个楼层（不再只有"其他楼层"）
3. 保持与现有组件的兼容性

**您只需要按照上述任意一种方案调整后端API响应格式，前端就能立即支持正确的楼层显示。**

## 建议优先级

1. **🔥 紧急**：采用方案1，在现有数据中增加楼层字段
2. **📈 中期**：采用方案2，重构为楼层分组结构
3. **🚀 长期**：采用完整的四级层次结构

这样既能快速解决当前问题，又为未来的功能扩展打下基础。